# dmrgo

[![License](https://badgen.net/github/license/USA-RedDragon/dmrgo)](https://github.com/USA-RedDragon/dmrgo/blob/main/LICENSE.md) [![GoReportCard](https://goreportcard.com/badge/github.com/USA-RedDragon/dmrgo)](https://goreportcard.com/report/github.com/USA-RedDragon/dmrgo) [![codecov](https://codecov.io/gh/USA-RedDragon/dmrgo/graph/badge.svg?token=ON6XI1I21H)](https://codecov.io/gh/USA-RedDragon/dmrgo)

This library decodes and encodes raw 33-byte DMR packets per the ETSI TS 102 361 specification into Golang-native structures.

## Usage

```go
package main

import (
	"fmt"

	"github.com/USA-RedDragon/dmrgo/v2/enums"
	"github.com/USA-RedDragon/dmrgo/v2/layer2"
)

func main() {
	// A single 33-byte DMR burst (voice LC header)
	raw := [33]byte{
		68, 75, 3, 135, 36, 66, 12, 240, 21, 240,
		12, 161, 196, 109, 255, 87, 215, 93, 245, 222,
		49, 168, 53, 24, 63, 48, 61, 97, 56, 82,
		151, 134, 91,
	}

	burst, err := layer2.NewBurstFromBytes(raw)
	if err != nil {
		fmt.Printf("Error: %v\n", err)
		return
	}

	fmt.Printf("Sync: %s\n", enums.SyncPatternToName(burst.SyncPattern))
	fmt.Printf("Burst: %s\n", burst.ToString())

	// Re-encode back to 33 bytes
	encoded := burst.Encode()
	fmt.Printf("Encoded %d bytes\n", len(encoded))

	// Zero-allocation path: reuse a Burst across calls
	var reusable layer2.Burst
	for _, raw := range [][33]byte{raw} {
		if err := reusable.DecodeFromBytes(raw); err != nil {
			fmt.Printf("Error: %v\n", err)
			continue
		}
		fmt.Println(reusable.ToString())
	}
}
```

## ETSI TS 102 361 Specification Coverage
<!-- BEGIN ETSI COVERAGE -->

*Auto-generated by `cmd/speccheck --update-readme`. Status derived from test execution.*

### Summary

| Metric | Count |
| --- | --- |
| Total sections | 118 |
| âœ… Verified (tests pass) | 55 |
| âŒ Failing (tests fail) | 0 |
| ğŸ”¶ Untested (has source, no tests) | 2 |
| â¬œ Unimplemented | 61 |

**Overall: 55/118 verified (46.6%)**

### ETSI TS 102 361-1 â€” Air Interface Protocol

**59** sections - âœ… 34  âŒ 0  ğŸ”¶ 0  â¬œ 25

`[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 57.6%`

| Section | Title | Status | Tests | Source Files |
| --- | --- | --- | --- | --- |
| Â§6.1 | Vocoder socket | âœ… verified | 6/6 passed | `v2/layer2/burst.go`, `v2/vocoder/frame.go`, `v2/layer2/pdu/vocoder.go` |
| Â§6.2 | Data and control | âœ… verified | 2/2 passed | `v2/layer2/burst.go`, `v2/enums/burst_types.go` |
| Â§6.3 | Common Announcement Channel burst | â¬œ unimplemented | - | - |
| Â§6.4 | Reverse Channel | â¬œ unimplemented | - | - |
| Â§7.1.1 | Voice LC header | âœ… verified | 4/4 passed | `v2/layer2/burst.go`, `v2/layer2/pdu/full_link_control.go` |
| Â§7.1.2 | Terminator with LC | âœ… verified | 4/4 passed | `v2/layer2/burst.go`, `v2/layer2/pdu/full_link_control.go` |
| Â§7.1.3 | Embedded signalling | âœ… verified | 4/4 passed | `v2/layer2/burst.go`, `v2/layer2/pdu/embedded_signalling.go` |
| Â§7.1.4 | Short Link Control in CACH | â¬œ unimplemented | - | - |
| Â§7.2.1 | Control Signalling BlocK (CSBK) | âœ… verified | 4/4 passed | `v2/layer2/pdu/csbk.go` |
| Â§7.3 | Idle message | â¬œ unimplemented | - | - |
| Â§7.4.1 | Multi Block Control (MBC) | â¬œ unimplemented | - | - |
| Â§8.2.1 | Header block structure | âœ… verified | 3/3 passed | `v2/layer2/pdu/data_header.go` |
| Â§8.2.3.1 | Unified Single Block Data block structure | â¬œ unimplemented | - | - |
| Â§9.1.1 | Synchronization (SYNC) PDU | âœ… verified | 5/5 passed | `v2/enums/sync_patterns.go`, `v2/layer2/burst.go` |
| Â§9.1.2 | Embedded signalling (EMB) PDU | âœ… verified | 5/5 passed | `v2/layer2/pdu/embedded_signalling.go` |
| Â§9.1.3 | Slot Type (SLOT) PDU | âœ… verified | 4/4 passed | `v2/layer2/pdu/slot_type.go` |
| Â§9.1.4 | TACT PDU | â¬œ unimplemented | - | - |
| Â§9.1.5 | Reverse Channel (RC) PDU | â¬œ unimplemented | - | - |
| Â§9.1.6 | Full Link Control (FULL LC) PDU | âœ… verified | 7/7 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§9.1.7 | Short Link Control (SHORT LC) PDU | â¬œ unimplemented | - | - |
| Â§9.1.8 | Control Signalling Block (CSBK) PDU | âœ… verified | 4/4 passed | `v2/layer2/pdu/csbk.go` |
| Â§9.1.9 | Pseudo Random Fill Bit (PR FILL) PDU | â¬œ unimplemented | - | - |
| Â§9.2.2 | Rate Â¾ coded packet Data (R_3_4_DATA) PDU | âœ… verified | 5/5 passed | `v2/layer2/pdu/rate34_data.go` |
| Â§9.2.6 | Unconfirmed data packet Header (U_HEAD) PDU | âœ… verified | 3/3 passed | `v2/layer2/pdu/data_header.go` |
| Â§9.2.7 | Rate Â½ coded packet Data (R_1_2_DATA) PDU | âœ… verified | 5/5 passed | `v2/layer2/pdu/rate12_data.go` |
| Â§9.2.15 | Rate 1 coded packet Data (R_1_DATA) PDU | âœ… verified | 5/5 passed | `v2/layer2/pdu/rate1_data.go` |
| Â§9.3.1 | Colour Code (CC) | âœ… verified | 3/3 passed | `v2/layer2/pdu/embedded_signalling.go`, `v2/layer2/pdu/slot_type.go` |
| Â§9.3.2 | Pre-emption and power control Indicator (PI) | â¬œ unimplemented | - | - |
| Â§9.3.3 | LC Start/Stop (LCSS) | âœ… verified | 4/4 passed | `v2/enums/lcss.go` |
| Â§9.3.4 | EMB parity | â¬œ unimplemented | - | - |
| Â§9.3.5 | Feature set ID (FID) | âœ… verified | 5/5 passed | `v2/enums/feature_set_id.go` |
| Â§9.3.6 | Data Type | âœ… verified | 3/3 passed | `v2/layer2/elements/data_types.go`, `v2/layer2/elements/data.go` |
| Â§9.3.10 | Protect Flag (PF) | â¬œ unimplemented | - | - |
| Â§9.3.11 | Full Link Control Opcode (FLCO) | âœ… verified | 3/3 passed | `v2/enums/flco.go` |
| Â§9.3.17 | Data Packet Format (DPF) | âœ… verified | 1/1 passed | `v2/layer2/pdu/data_header.go` |
| Â§9.3.19 | Logical Link ID (LLID) | âœ… verified | 3/3 passed | `v2/layer2/pdu/full_link_control.go`, `v2/layer2/pdu/csbk.go` |
| Â§9.3.32 | Control Signalling BlocK Opcode (CSBKO) | âœ… verified | 1/1 passed | `v2/layer2/pdu/csbk.go` |
| Â§B.1.1 | BPTC (196,96) | âœ… verified | 1/1 passed | `v2/fec/bptc/bptc_196_96.go` |
| Â§B.2.1 | Variable length BPTC for embedded signalling | â¬œ unimplemented | - | - |
| Â§B.2.2 | Single Burst Variable length BPTC | â¬œ unimplemented | - | - |
| Â§B.2.3 | Variable length BPTC for CACH signalling | â¬œ unimplemented | - | - |
| Â§B.2.4 | Rate Â¾ Trellis code | âœ… verified | 1/1 passed | `v2/fec/trellis/trellis_3_4.go` |
| Â§B.2.5 | Rate 1 coded data | âœ… verified | 1/1 passed | `v2/layer2/burst.go` |
| Â§B.3.1 | Golay (20,8) | âœ… verified | 1/1 passed | `v2/fec/golay/golay_20_8_7.go` |
| Â§B.3.2 | Quadratic residue (16,7,6) | âœ… verified | 1/1 passed | `v2/fec/quadratic_residue/quadratic_residue_16_7_6.go` |
| Â§B.3.3 | Hamming (17,12,3) | âœ… verified | 1/1 passed | `v2/fec/bptc/bptc_196_96.go` |
| Â§B.3.4 | Hamming (13,9,3), Hamming (15,11,3), and Hamming (16,11,4) | âœ… verified | 1/1 passed | `v2/fec/bptc/bptc_196_96.go` |
| Â§B.3.5 | Hamming (7,4,3) | â¬œ unimplemented | - | - |
| Â§B.3.6 | Reed-Solomon (12,9) | âœ… verified | 18/18 passed | `v2/fec/reed_solomon/reed_solomon_12_9_4.go` |
| Â§B.3.7 | 8-bit CRC calculation | â¬œ unimplemented | - | - |
| Â§B.3.8 | CRC-CCITT calculation | âœ… verified | 3/3 passed | `v2/crc/crc_ccitt.go` |
| Â§B.3.9 | 32-bit CRC calculation | â¬œ unimplemented | - | - |
| Â§B.3.10 | CRC-9 calculation | â¬œ unimplemented | - | - |
| Â§B.3.11 | 5-bit Checksum (CS) calculation | â¬œ unimplemented | - | - |
| Â§B.3.12 | Data Type CRC Mask | âœ… verified | 3/3 passed | `v2/crc/crc_ccitt.go` |
| Â§B.3.13 | 7-bit CRC calculation | â¬œ unimplemented | - | - |
| Â§B.4 | Interleaving | â¬œ unimplemented | - | - |
| Â§D | Idle and Null message bit definition | â¬œ unimplemented | - | - |
| Â§E | Transmit bit order | â¬œ unimplemented | - | - |

### ETSI TS 102 361-2 â€” DMR Voice and Generic Services and Facilities

**32** sections - âœ… 21  âŒ 0  ğŸ”¶ 2  â¬œ 9

`[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 65.6%`

| Section | Title | Status | Tests | Source Files |
| --- | --- | --- | --- | --- |
| Â§5.4.2 | Inband positioning data service | âœ… verified | 1/1 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§5.4.3 | Inband talker alias data service | âœ… verified | 1/1 passed | `v2/layer2/pdu/full_link_control.go`, `v2/layer3/elements/talker_alias_data_format.go` |
| Â§6.1 | Transmit timeout | â¬œ unimplemented | - | - |
| Â§6.3 | Reverse Channel Transmitter Interrupt | â¬œ unimplemented | - | - |
| Â§7.1.1 | Full Link Control PDUs | âœ… verified | 3/3 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.1.1.1 | Group Voice Channel User LC PDU | âœ… verified | 2/2 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.1.1.2 | Unit to Unit Voice Channel User LC PDU | âœ… verified | 2/2 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.1.1.3 | GPS Info LC PDU | âœ… verified | 1/1 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.1.1.4 | Talker Alias header LC PDU | âœ… verified | 3/3 passed | `v2/layer2/pdu/full_link_control.go`, `v2/layer3/elements/talker_alias_data_format.go` |
| Â§7.1.1.5 | Talker Alias block LC PDU | ğŸ”¶ untested | - | `v2/layer2/pdu/full_link_control.go` |
| Â§7.1.2 | Control Signalling BlocK (CSBK) PDUs | âœ… verified | 4/4 passed | `v2/layer2/pdu/csbk.go` |
| Â§7.1.2.4 | Negative Acknowledge Response CSBK PDU | âœ… verified | 1/1 passed | `v2/layer2/pdu/csbk.go` |
| Â§7.1.2.5 | Preamble CSBK PDU | âœ… verified | 1/1 passed | `v2/layer2/pdu/csbk.go` |
| Â§7.1.3 | Short Link Control PDUs | â¬œ unimplemented | - | - |
| Â§7.2.1 | Service Options | âœ… verified | 4/4 passed | `v2/layer3/elements/service_options.go` |
| Â§7.2.2 | Answer Response | âœ… verified | 1/1 passed | `v2/layer2/pdu/csbk.go` |
| Â§7.2.3 | Reason Code | âœ… verified | 1/1 passed | `v2/layer2/pdu/csbk.go` |
| Â§7.2.4 | Service Type | â¬œ unimplemented | - | - |
| Â§7.2.5 | Source Type | â¬œ unimplemented | - | - |
| Â§7.2.6 | Additional Information Field | â¬œ unimplemented | - | - |
| Â§7.2.7 | CSBK Blocks to Follow (CBF) | âœ… verified | 1/1 passed | `v2/layer2/pdu/csbk.go` |
| Â§7.2.8 | Identifier (ID) | âœ… verified | 3/3 passed | `v2/layer2/pdu/full_link_control.go`, `v2/layer2/pdu/csbk.go` |
| Â§7.2.15 | Position Error | âœ… verified | 3/3 passed | `v2/layer3/elements/position_error.go` |
| Â§7.2.16 | Longitude | âœ… verified | 1/1 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.2.17 | Latitude | âœ… verified | 1/1 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.2.18 | Talker Alias Data Format | âœ… verified | 3/3 passed | `v2/layer3/elements/talker_alias_data_format.go` |
| Â§7.2.19 | Talker Alias Data Length | ğŸ”¶ untested | - | `v2/layer2/pdu/full_link_control.go` |
| Â§7.2.20 | Tier 2 Reverse Channel (RC) Command | â¬œ unimplemented | - | - |
| Â§A | Timers and constants in DMR | â¬œ unimplemented | - | - |
| Â§B.1 | Full Link Control Opcode List | âœ… verified | 2/2 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§B.2 | CSBK Opcode List | âœ… verified | 1/1 passed | `v2/layer2/pdu/csbk.go` |
| Â§B.3 | Short Link Control Opcode List | â¬œ unimplemented | - | - |

### ETSI TS 102 361-3 â€” DMR Data Protocol

**13** sections - âœ… 0  âŒ 0  ğŸ”¶ 0  â¬œ 13

`[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0.0%`

| Section | Title | Status | Tests | Source Files |
| --- | --- | --- | --- | --- |
| Â§5.3 | Unconfirmed data DLL bearer service | â¬œ unimplemented | - | - |
| Â§5.4 | Confirmed data DLL bearer service | â¬œ unimplemented | - | - |
| Â§5.5 | UDP/IPv4 data | â¬œ unimplemented | - | - |
| Â§5.6 | UDP/IPv4 header compression | â¬œ unimplemented | - | - |
| Â§6.1 | Defined Data | â¬œ unimplemented | - | - |
| Â§6.2 | Raw data | â¬œ unimplemented | - | - |
| Â§6.3 | Status/precoded data | â¬œ unimplemented | - | - |
| Â§6.4 | Short data confirmed response | â¬œ unimplemented | - | - |
| Â§7.1.1 | Full Link Control (FULL LC) PDUs | â¬œ unimplemented | - | - |
| Â§7.1.1.1 | Terminator Data Link Control PDU | â¬œ unimplemented | - | - |
| Â§7.2 | UDP/IPv4 Compressed Header | â¬œ unimplemented | - | - |
| Â§A | PDP timers and constants in DMR | â¬œ unimplemented | - | - |
| Â§B.1 | PDP Full Link Control Opcode list | â¬œ unimplemented | - | - |

### ETSI TS 102 361-4 â€” DMR Trunking Protocol

**14** sections - âœ… 0  âŒ 0  ğŸ”¶ 0  â¬œ 14

`[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0.0%`

| Section | Title | Status | Tests | Source Files |
| --- | --- | --- | --- | --- |
| Â§5.1 | The Use of the CACH | â¬œ unimplemented | - | - |
| Â§5.2 | Tier III Signalling | â¬œ unimplemented | - | - |
| Â§5.3 | Modes of Control Channel | â¬œ unimplemented | - | - |
| Â§5.4 | CSBK/MBC/UDT/USBD Block Structure | â¬œ unimplemented | - | - |
| Â§6.1 | Basic Structure | â¬œ unimplemented | - | - |
| Â§6.2 | Random Access Procedures | â¬œ unimplemented | - | - |
| Â§6.6 | Call Procedures | â¬œ unimplemented | - | - |
| Â§7.1.1 | Control Signalling Block (CSBK/MBC/UDT) PDUs | â¬œ unimplemented | - | - |
| Â§7.1.1.1 | TSCC Outbound channel CSBK/MBC/UDT | â¬œ unimplemented | - | - |
| Â§7.1.2 | Short Link Control PDUs | â¬œ unimplemented | - | - |
| Â§7.2 | Layer 3 Information Element Coding | â¬œ unimplemented | - | - |
| Â§A | Timers, constants levels and addresses | â¬œ unimplemented | - | - |
| Â§B.1 | CSBK/MBC/UDT Opcode List | â¬œ unimplemented | - | - |
| Â§B.2 | Short Link Control Opcode List | â¬œ unimplemented | - | - |

<!-- END ETSI COVERAGE -->
