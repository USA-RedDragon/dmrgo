# dmrgo

[![License](https://badgen.net/github/license/USA-RedDragon/dmrgo)](https://github.com/USA-RedDragon/dmrgo/blob/main/LICENSE.md) [![GoReportCard](https://goreportcard.com/badge/github.com/USA-RedDragon/dmrgo)](https://goreportcard.com/report/github.com/USA-RedDragon/dmrgo) [![codecov](https://codecov.io/gh/USA-RedDragon/dmrgo/graph/badge.svg?token=ON6XI1I21H)](https://codecov.io/gh/USA-RedDragon/dmrgo)

This library decodes a raw 33-byte DMR packet into Golang-native structures.

## Usage

A complete example can be found at `examples/benchmark.go`

The full definitions of `EXAMPLE_DMR_PARROT_KERCHUNK_BURSTS`
and `EXAMPLE_DMR_SMS_BURSTS` are excluded for brevity.

```go
const (
    DMR_BURST_SIZE = 33

    DMR_PARROT_KERCHUNK_BURST_COUNT = 15
    DMR_SMS_BURST_COUNT             = 8
)

var EXAMPLE_DMR_PARROT_KERCHUNK_BURSTS = [DMR_PARROT_KERCHUNK_BURST_COUNT][DMR_BURST_SIZE]byte{
    {68, 75, 3, 135, 36, 66, 12, 240, 21, 240, 12, 161, 196, 109, 255, 87, 215, 93, 245, 222, 49, 168, 53, 24, 63, 48, 61, 97, 56, 82, 151, 134, 91},           // First, burst
    ...
}

var EXAMPLE_DMR_SMS_BURSTS = [DMR_SMS_BURST_COUNT][DMR_BURST_SIZE]byte{
    {66, 74, 30, 185, 189, 0, 34, 4, 51, 201, 3, 83, 4, 205, 255, 87, 215, 93, 245, 218, 200, 246, 69, 24, 215, 120, 191, 128, 181, 29, 41, 17, 231},
    ...
}

func main() {
    for _, rawBurst := range EXAMPLE_DMR_PARROT_KERCHUNK_BURSTS {
        timeStarted := time.Now()
        burst, err := layer2.NewBurstFromBytes(rawBurst)
        if err != nil {
            fmt.Printf("Error decoding burst: %v\n", err)
            continue
        }
        timeElapsed := time.Since(timeStarted)
        fmt.Printf("%s: %v\n", enums.SyncPatternToName(burst.SyncPattern), burst.ToString())
        fmt.Printf("Took %s to decode burst\n", timeElapsed)
    }

    fmt.Println("---------------------------------")

    for _, rawBurst := range EXAMPLE_DMR_SMS_BURSTS {
        timeStarted := time.Now()
        burst, err := layer2.NewBurstFromBytes(rawBurst)
        if err != nil {
            fmt.Printf("Error decoding burst: %v\n", err)
            continue
        }
        timeElapsed := time.Since(timeStarted)
        fmt.Printf("%s: %v\n", enums.SyncPatternToName(burst.SyncPattern), burst.ToString())
        fmt.Printf("Took %s to decode burst\n", timeElapsed)
    }
}
```

## ETSI TS 102 361 Specification Coverage
<!-- BEGIN ETSI COVERAGE -->

*Auto-generated by `cmd/speccheck --update-readme`. Status derived from test execution.*

### Summary

| Metric | Count |
| --- | --- |
| Total sections | 90 |
| âœ… Verified (tests pass) | 59 |
| âŒ Failing (tests fail) | 0 |
| ğŸ”¶ Untested (has source, no tests) | 0 |
| â¬œ Unimplemented | 31 |

**Overall: 59/90 verified (65.6%)**

### ETSI TS 102 361-1 V2.5.1 (2017-10) â€” Air Interface Protocol

**49** sections - âœ… 38  âŒ 0  ğŸ”¶ 0  â¬œ 11

`[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘] 77.6%`

| Section | Title | Status | Tests | Source Files |
| --- | --- | --- | --- | --- |
| Â§6.1 | Burst format | âœ… verified | 2/2 passed | `v2/layer2/burst.go`, `v2/enums/burst_types.go` |
| Â§6.2 | Burst classification (sync patterns) | âœ… verified | 5/5 passed | `v2/layer2/burst.go`, `v2/enums/sync_patterns.go`, `v2/enums/voice_burst_types.go` |
| Â§7.1 | Voice channel coding (AMBE+2 vocoder) | âœ… verified | 4/4 passed | `v2/vocoder/frame.go`, `v2/layer2/pdu/vocoder.go` |
| Â§7.2 | Data channel coding Rate 1/2 (BPTC 196,96) | âœ… verified | 1/1 passed | `v2/fec/bptc/bptc_196_96.go` |
| Â§7.3 | Data channel coding Rate 3/4 (Trellis) | âœ… verified | 1/1 passed | `v2/fec/trellis/trellis_3_4.go` |
| Â§7.4 | Data channel coding Rate 1 (passthrough) | âœ… verified | 1/1 passed | `v2/layer2/burst.go` |
| Â§7.5 | Slot Type coding (Golay 20,8,7) | âœ… verified | 4/4 passed | `v2/fec/golay/golay_20_8_7.go`, `v2/layer2/pdu/slot_type.go` |
| Â§7.6 | EMB coding (QR 16,7,6) | âœ… verified | 4/4 passed | `v2/fec/quadratic_residue/quadratic_residue_16_7_6.go`, `v2/layer2/pdu/embedded_signalling.go` |
| Â§7.7 | CACH coding (Hamming 7,4) | â¬œ unimplemented | - | - |
| Â§9.1.1 | SYNC PDU | âœ… verified | 2/2 passed | `v2/enums/sync_patterns.go`, `v2/layer2/burst.go` |
| Â§9.1.2 | EMB PDU | âœ… verified | 5/5 passed | `v2/layer2/pdu/embedded_signalling.go` |
| Â§9.1.3 | Slot Type PDU | âœ… verified | 4/4 passed | `v2/layer2/pdu/slot_type.go` |
| Â§9.1.4 | CACH PDU | â¬œ unimplemented | - | - |
| Â§9.1.5 | Voice LC Header/Terminator | âœ… verified | 4/4 passed | `v2/layer2/burst.go`, `v2/layer2/pdu/full_link_control.go` |
| Â§9.1.6 | Full Link Control PDU | âœ… verified | 7/7 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§9.1.7 | CSBK PDU | âœ… verified | 4/4 passed | `v2/layer2/pdu/csbk.go` |
| Â§9.1.8 | Data Header PDU | âœ… verified | 3/3 passed | `v2/layer2/pdu/data_header.go` |
| Â§9.1.9 | Rate 1/2 Data PDU | âœ… verified | 5/5 passed | `v2/layer2/pdu/rate12_data.go` |
| Â§9.1.10 | Rate 3/4 Data PDU | âœ… verified | 5/5 passed | `v2/layer2/pdu/rate34_data.go` |
| Â§9.1.11 | Rate 1 Data PDU | âœ… verified | 5/5 passed | `v2/layer2/pdu/rate1_data.go` |
| Â§9.1.12 | PI Header PDU | â¬œ unimplemented | - | - |
| Â§9.1.13 | Unified Single Block PDU | â¬œ unimplemented | - | - |
| Â§9.1.14 | MBC Header PDU | â¬œ unimplemented | - | - |
| Â§9.1.15 | MBC Continuation PDU | â¬œ unimplemented | - | - |
| Â§9.3.1 | Colour Code | âœ… verified | 3/3 passed | `v2/layer2/pdu/embedded_signalling.go`, `v2/layer2/pdu/slot_type.go` |
| Â§9.3.2 | PI (Privacy Indicator) | â¬œ unimplemented | - | - |
| Â§9.3.3 | LCSS | âœ… verified | 4/4 passed | `v2/enums/lcss.go` |
| Â§9.3.4 | FLCO | âœ… verified | 3/3 passed | `v2/enums/flco.go` |
| Â§9.3.5 | Feature Set ID | âœ… verified | 5/5 passed | `v2/enums/feature_set_id.go` |
| Â§9.3.6 | Data Type | âœ… verified | 3/3 passed | `v2/layer2/elements/data_types.go`, `v2/layer2/elements/data.go` |
| Â§9.3.7 | Service Options | âœ… verified | 4/4 passed | `v2/layer3/elements/service_options.go` |
| Â§9.3.8 | Source/Destination Address | âœ… verified | 3/3 passed | `v2/layer2/pdu/full_link_control.go`, `v2/layer2/pdu/csbk.go` |
| Â§9.3.9 | CRC masks | âœ… verified | 3/3 passed | `v2/crc/crc_ccitt.go` |
| Â§B.1 | Hamming codes | âœ… verified | 1/1 passed | `v2/fec/bptc/bptc_196_96.go` |
| Â§B.2 | CRC polynomials | âœ… verified | 2/2 passed | `v2/crc/crc_ccitt.go` |
| Â§B.3.1 | Golay(20,8,7) | âœ… verified | 1/1 passed | `v2/fec/golay/golay_20_8_7.go` |
| Â§B.3.2 | Quadratic Residue(16,7,6) | âœ… verified | 1/1 passed | `v2/fec/quadratic_residue/quadratic_residue_16_7_6.go` |
| Â§B.3.3 | Golay(23,12,7) | âœ… verified | 1/1 passed | `v2/fec/golay/golay_23_12_7.go` |
| Â§B.3.4 | BPTC(196,96) | âœ… verified | 1/1 passed | `v2/fec/bptc/bptc_196_96.go` |
| Â§B.3.5 | Golay(24,12,8) | âœ… verified | 1/1 passed | `v2/fec/golay/golay_24_12_8.go` |
| Â§B.3.6 | Variable-length BPTC | â¬œ unimplemented | - | - |
| Â§B.3.7 | Convolutional/Trellis coding | âœ… verified | 1/1 passed | `v2/fec/trellis/trellis_3_4.go` |
| Â§B.3.8 | CRC-CCITT | âœ… verified | 3/3 passed | `v2/crc/crc_ccitt.go` |
| Â§B.3.9 | Reed-Solomon(12,9,4) | âœ… verified | 18/18 passed | `v2/fec/reed_solomon/reed_solomon_12_9_4.go` |
| Â§B.3.10 | Single-burst Trellis coded modulation | â¬œ unimplemented | - | - |
| Â§B.3.11 | Rate 3/4 Trellis | âœ… verified | 1/1 passed | `v2/fec/trellis/trellis_3_4.go` |
| Â§C | AMBE+2 vocoder frame structure | âœ… verified | 3/3 passed | `v2/vocoder/frame.go` |
| Â§D | PRNG | â¬œ unimplemented | - | - |
| Â§E | Encryption (ARC4/AES) | â¬œ unimplemented | - | - |

### ETSI TS 102 361-2 V2.4.1 (2017-10) â€” Voice and Generic Services

**29** sections - âœ… 21  âŒ 0  ğŸ”¶ 0  â¬œ 8

`[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 72.4%`

| Section | Title | Status | Tests | Source Files |
| --- | --- | --- | --- | --- |
| Â§7.1.1 | Full LC PDU opcodes | âœ… verified | 3/3 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.1.2 | Embedded LC assembly | âœ… verified | 4/4 passed | `v2/layer2/burst.go`, `v2/layer2/pdu/embedded_signalling.go` |
| Â§7.1.3 | Short LC (CACH) | â¬œ unimplemented | - | - |
| Â§7.2.1 | Service Options | âœ… verified | 4/4 passed | `v2/layer3/elements/service_options.go` |
| Â§7.2.2 | Group Address | âœ… verified | 2/2 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.2.3 | Source Address | âœ… verified | 3/3 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.2.4 | Destination Address | âœ… verified | 2/2 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.2.5 | Algorithm ID | â¬œ unimplemented | - | - |
| Â§7.2.6 | Key ID | â¬œ unimplemented | - | - |
| Â§7.2.7 | Message Indicator (MI) | â¬œ unimplemented | - | - |
| Â§7.2.8 | Answer/Response | âœ… verified | 1/1 passed | `v2/layer2/pdu/csbk.go` |
| Â§7.2.9 | Reason Code | âœ… verified | 1/1 passed | `v2/layer2/pdu/csbk.go` |
| Â§7.2.10 | N(S)/N(R) sequence numbers | â¬œ unimplemented | - | - |
| Â§7.2.11 | Data Packet Format | âœ… verified | 1/1 passed | `v2/layer2/pdu/data_header.go` |
| Â§7.2.12 | SAP Identifier | â¬œ unimplemented | - | - |
| Â§7.2.13 | Full Message Flag | âœ… verified | 1/1 passed | `v2/layer2/pdu/data_header.go` |
| Â§7.2.14 | Blocks to Follow | âœ… verified | 1/1 passed | `v2/layer2/pdu/data_header.go` |
| Â§7.2.15 | Position Error | âœ… verified | 3/3 passed | `v2/layer3/elements/position_error.go` |
| Â§7.2.16 | Longitude | âœ… verified | 1/1 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.2.17 | Latitude | âœ… verified | 1/1 passed | `v2/layer2/pdu/full_link_control.go` |
| Â§7.2.18 | Talker Alias Data Format | âœ… verified | 3/3 passed | `v2/layer3/elements/talker_alias_data_format.go` |
| Â§7.2.19 | Talker Alias Data | âœ… verified | 1/1 passed | `v2/layer2/pdu/full_link_control.go`, `v2/layer3/elements/talker_alias_data_format.go` |
| Â§7.2.20 | CSBK Opcode definitions | âœ… verified | 3/3 passed | `v2/layer2/pdu/csbk.go` |
| Â§7.2.21 | Data Header sub-formats | âœ… verified | 2/2 passed | `v2/layer2/pdu/data_header.go` |
| Â§6.1-6.5 | Short data services (Defined, Raw, SDD, UDT, IP) | â¬œ unimplemented | - | - |
| Â§9 | Location services (LRRP) | â¬œ unimplemented | - | - |
| Â§A | CSBK opcode table (complete) | âœ… verified | 1/1 passed | `v2/layer2/pdu/csbk.go` |
| Â§B | Data header format field tables | âœ… verified | 1/1 passed | `v2/layer2/pdu/data_header.go` |
| Â§C | Full LC opcode table (complete) | âœ… verified | 2/2 passed | `v2/layer2/pdu/full_link_control.go` |

### ETSI TS 102 361-3 â€” Data Protocol / Trunking Type 1 (Tier III)

**7** sections - âœ… 0  âŒ 0  ğŸ”¶ 0  â¬œ 7

`[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0.0%`

| Section | Title | Status | Tests | Source Files |
| --- | --- | --- | --- | --- |
| Â§6.1 | Channel Grant CSBK | â¬œ unimplemented | - | - |
| Â§6.2 | Move CSBK | â¬œ unimplemented | - | - |
| Â§6.3 | Aloha CSBK (trunking variant) | â¬œ unimplemented | - | - |
| Â§6.4 | C_BCAST / Site/Neighbour CSBK | â¬œ unimplemented | - | - |
| Â§8 | MBC Header + Continuation formats | â¬œ unimplemented | - | - |
| Â§9 | Trunking information elements | â¬œ unimplemented | - | - |
| Â§A | CSBK opcode table (Tier III) | â¬œ unimplemented | - | - |

### ETSI TS 102 361-4 â€” Trunking Protocol Type 2 (Capacity Plus / Connect Plus)

**5** sections - âœ… 0  âŒ 0  ğŸ”¶ 0  â¬œ 5

`[â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0.0%`

| Section | Title | Status | Tests | Source Files |
| --- | --- | --- | --- | --- |
| Â§5.1 | Rest channel burst format | â¬œ unimplemented | - | - |
| Â§5.2 | CSBK opcodes (Type 2) | â¬œ unimplemented | - | - |
| Â§6.1 | C_SYS_PARM | â¬œ unimplemented | - | - |
| Â§6.2 | ADJ_STS_BCAST | â¬œ unimplemented | - | - |
| Â§A | Control PDU opcodes for Type 2 | â¬œ unimplemented | - | - |

<!-- END ETSI COVERAGE -->
